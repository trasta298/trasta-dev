---
import ThemeIcon from './ThemeIcon.astro'
import { css } from '../../styled-system/css'
import { getLocalePath, type Lang } from '../i18n/utils'

interface Props {
  lang: Lang
}

const { lang } = Astro.props
const aboutPath = getLocalePath('/about', lang)
const homePath = getLocalePath('/', lang)
---

<header
  class={css({
    w: '100%',
    h: '64px',
    display: 'flex',
    alignItems: 'center',
    justifyContent: 'center',
    bg: 'bgSecond',
    transition: 'background 0.3s',
  })}
>
  <div
    class={css({
      display: 'grid',
      gridTemplateColumns: 'auto 1fr',
      alignItems: 'center',
      maxWidth: '1024px',
      width: '100%',
      px: '16px',
    })}
  >
    <div
      class={css({
        gridColumn: '1 / 2',
        fontSize: '24px',
      })}
    >
      <a
        id="titleA"
        href={aboutPath}
        data-home={homePath}
        data-about={aboutPath}
        class={css({ color: 'text', textDecoration: 'none' })}
      >
        trasta.dev</a
      >
    </div>
    <div
      class={css({
        gridColumn: '2 / 3',
        display: 'flex',
        alignItems: 'center',
        justifyContent: 'flex-end',
      })}
    >
      <div class={css({ userSelect: 'none' })}>
        <ThemeIcon />
      </div>
    </div>
  </div>
</header>

<script is:inline>
  const setHref = () => {
    const titleA = document.getElementById('titleA')
    if (!titleA) return
    const homePath = titleA.dataset.home
    const aboutPath = titleA.dataset.about
    const currentPath = location.pathname.replace(/\/$/, '') || '/'
    const aboutPathNormalized = aboutPath?.replace(/\/$/, '') || '/about'
    if (currentPath === aboutPathNormalized) {
      titleA.setAttribute('href', homePath || '/')
    } else {
      titleA.setAttribute('href', aboutPath || '/about')
    }
  }
  setHref()
  document.addEventListener('astro:after-swap', setHref)
</script>
